<!DOCTYPE html>

<!--
  COLLABORATORS:
  
-->
<html>

<head>
<meta charset="UTF-8">
<title>Checkerboard</title>

<!-- Load style sheets -->
<link rel="stylesheet" href="mainLayout.css" />
</head>

<body>

<table id="mainTable">
    <tr>
        <td id="navigation">
          <table>
			  <tr><td id="flag"></td></tr>
              <tr><td><input id="btnNewGame" type="button" name="new" value="New Game"/></td></tr>
              <tr><td><input id="btnAutoMove" type="button" name="new" value="Auto Move"/></td></tr>

            </table>
        </td>

        <td id="content">
            <table id="checkerboard" border="0" cellpadding="0" cellspacing="0">
            </table>

        </td>
    </tr>
</table>


<!-- Load any supplemental Javascript libraries here -->
<script type="text/javascript" src="external_js/jquery-1.9.0.min.js"></script>
<script type="text/javascript" src="checker.js"></script>
<script type="text/javascript" src="boardEvent.js"></script>
<script type="text/javascript" src="board.js"></script>
<script type="text/javascript" src="rules.js"></script>

<script type="text/javascript">
//This script extracts parameters from the URL
//from jquery-howto.blogspot.com
    $.extend({
        getUrlVars : function() {
            var vars = [], hash;
            var hashes = window.location.href.slice(
                    window.location.href.indexOf('?') + 1).split('&');
            for ( var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        },
        getUrlVar : function(name) {
            return $.getUrlVars()[name];
        }
    });

    var size = 8; 
    var DEFAULT_BOARD_SIZE = 8;

    //data model
    var board;
    var rules;
    var whoseTurn = "black";    

    var directionOf = function(color) {
      if (color == "black") {
        return -1;
      }
      return 1;
    }

    // Fill in this function to toggle the display for whose turn
    // The color parameter should be either "black" or "red"
    var toggleTurn = function(color) {
        if (color){
            if (color=="black"){
                whoseTurn = "red";
                return whoseTurn;
            }
            whoseTurn = "black"; 
                return whoseTurn;
        }
    }



    // This allows the Javascript code inside this block to only run when the page
    // has finished loading in the browser.
    $(document).ready(function() {

        if ($.getUrlVar('size') && $.getUrlVar('size') >= 6) {
            board = new Board($.getUrlVar('size'));
            draw_checkerboard($.getUrlVar('size')); 
            size = $.getUrlVar('size'); 
        } else {
            board = new Board(DEFAULT_BOARD_SIZE);
            draw_checkerboard(DEFAULT_BOARD_SIZE); 
            size = DEFAULT_BOARD_SIZE; 
        }

    function update_flag(){
        var flag = document.getElementById("flag");
        if (whoseTurn == "black"){
            flag.innerHTML="Black's Turn";
            $(flag).css({"background-color":"black","height":"20px","color":"white"});
        }
        else{
            flag.innerHTML="Red's Turn"; 
            $(flag).css({"background-color":"red","height":"20px","color":"white"});    
        }
    }

    function draw_checkerboard(n){
        update_flag();
        var colors = ["grey_square","white_square"];
        var checkerboard = document.getElementById("checkerboard"); 
        var square_size = 400/n;
        for (i=0; i<n; i++){
            var new_row = checkerboard.insertRow(0); // eventually add to length of 
            color_id = i%2;
            for (j=0; j<n; j++){
                var new_square = document.createElement("td"); 
                $(new_square).addClass(colors[color_id%2]); 
                new_square.style.width = square_size.toString() + "px";
                new_square.style.height = square_size.toString() + "px";
                $(new_row).append(new_square);
                color_id += 1;
            }
        }
    }

    function draw_new_board(){
        update_flag();
        $('.piece').remove(); 
        var squaresize = 400/size;
        var piecesize = squaresize*.9; 
        var content = document.getElementById("content");
        var checkerboard = document.getElementById("checkerboard"); 
        for (row=0; row<size; row++){
            for (col=0; col<size; col++){
                var occupied = board.square[row][col];
                if (occupied){
                    var color = occupied.color;
                    var piece = document.createElement("img"); 
                    var color_source = ""; 
                    if (color == "red"){
                        color_source = 'graphics/red-piece.png'; 
                    }else{ 
                        color_source = 'graphics/black-piece.png'; 
                    }
                    $(piece).addClass("piece"); 
                    piece.setAttribute('src',color_source);
                    piece.setAttribute('width',squaresize); 
                    piece.setAttribute('height',squaresize); 
                    $(piece).css({"top":row*squaresize+1,"left":col*squaresize+1}); 
                    content.insertBefore(piece,checkerboard); 
                }
            }
        }
    }





    rules = new Rules(board);


        // Your code here

        board.addEventListener('add',function (e) {
            // Your code here
        },true);

        board.addEventListener('move',function (e) {
            // Your code here
        },true);

        board.addEventListener('remove', function(e) {
            // Your code here
        }, true);

        board.addEventListener('promote',function (e) {
            // Your code here
        },true);

        
        $("#btnNewGame").click(function(evt) {
            board.prepareNewGame();
            draw_new_board(); 
        });

        $("#btnAutoMove").click(function(evt) {
          var playerColor = whoseTurn;
          var playerDirection = directionOf(playerColor);
          var result = rules.makeRandomMove(playerColor, playerDirection);
          if (result != null) {
            toggleTurn(playerColor);
          }
          draw_new_board();
        });

        board.prepareNewGame();

    });
</script>

</body>

</html>
